# WebRTC

**WebRTC** 平时工作里很少接触这类技术, 如果用API来做分类, 它可以分为一下两种

- 媒体捕获
- 点对点连接


## 媒体获取

顾名思义, 用来获取本机的一个或多个媒体设备, 比如摄像头, 麦克风等等. 需要经过用户授权能使用. 下面这张图就是Chrome在请求得到你的授权
![image](https://user-images.githubusercontent.com/371511/125044803-e7b1b500-e0ce-11eb-8b3f-d36453f080ba.png)

通过这里(Chrome)检查自己开了哪些授权, 也可以手动的设置授权的级别
![image](https://user-images.githubusercontent.com/371511/125045655-cd2c0b80-e0cf-11eb-91e8-7bbe22e24b61.png)

媒体类别的API都非常简单, 无非以下几个步骤

1. 请求用户授权
2. 获取相关设备的数据, 一般是Stream
3. 使用对应数据来显示或播放. 比如请求Camera, 就需要添加到 `<video>`

```javascript
// 请求哪些媒体, PS: Camera还能设置是前摄还是后摄
const constraints = {
  audio: false,
  video: true
};

function handleSuccess(stream) {
  // video 就是页面上的一个 video标签
  video.srcObject = stream;
}

navigator.mediaDevices
  .getUserMedia(constraints)
  .then(handleSuccess)
  .catch(handleError);
```

如果用户没有摄像头怎么办? 其实媒体设备是可以查询的. 使用 `enumerateDevices()` API可以异步的获取用户的设备列表. 也非常简单, 这里简单放上来一段示例代码, 大家有个印象

```javascript
async function getConnectedDevices(type) {
    const devices = await navigator.mediaDevices.enumerateDevices();
    return devices.filter(device => device.kind === type)
}

const videoCameras = getConnectedDevices('videoinput');
console.log('Cameras found:', videoCameras);
```

其中有 `device.kind === type` 比较, 他的可选值为

- audioinput
- audiooutput
- videoinput


## 点对点连接

点对点也就是大家常说的 *p2p*. 这里会有些复杂, 涉及很多概念.


